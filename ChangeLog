2005-11-14  Michael Poole <mdpoole@troilus.org>

	* ircd/channel.c (member_can_send_to_channel): After prodding from
	reed, always allow remote users to send to a channel.  He also
	pointed out a bug in the first version of this change.

2005-11-14  Carlo Wood <run@alinoe.com>

	* ircd/channel.c (modebuf_flush_int): Fix test for limitdel.
	(modebuf_mode_uint): Make sure the limit is included as an
	argument when necessary (and only when necessary) in a bounce.

	* ircd/m_destruct.c (ms_destruct): Generate a mode bounce instead
	of burst to resynchronize a non-empty destructed channel.

2005-11-14  Michael Poole <mdpoole@troilus.org>

	* ircd/channel.c (find_no_nickchange_channel): Disallow nick
	changes by voiceless no-account users on a +r channel.

2005-11-14  Michael Poole <mdpoole@troilus.org>

	* ircd/m_kick.c (ms_kick): Fix test for whether a client's own
	server is kicking him.

2005-11-13  Carlo Wood <run@alinoe.com>

	* ircd/m_create (ms_create): Accept CREATE for zannels.

	* ircd/m_join.c (m_join): MODE +o for a zannel must come from the
	server for compatibility with older versions.

2005-11-11  Michael Poole <mdpoole@troilus.org>

	* doc/readme.cvs: Document tag name consistently with the release
	name.

	* ircd/ircd_res.c (proc_answer): Follow CNAME when doing A
	and AAAA lookups as well as PTR.

2005-11-07  Michael Poole <mdpoole@troilus.org>

	* ircd/channel.c (mode_parse_client): Allow clients to specify
	oplevel in MODE #channel +o.
	(mode_process_clients): Allow oplevel 999 to deop another 999.

	* ircd/kick.c (m_kick): Allow oplevel 999 to kick another 999.

2005-10-31  Michael Poole <mdpoole@troilus.org>
	(Based on a patch by Romain Bignon <progs@ir3.org>)

	* ircd/channel.c: Some modes (currently only WASDELJOINS) should
	not be propagated to remote servers.

2005-10-30  Michael Poole <mdpoole@troilus.org>

	* ircd/channel.c (mode_parse_apass): Move all send_reply() errors
	inside an if (MyUser(state->sptr)) test.

	* ircd/m_join.c (m_join): Reorganize zannel join check to match
	surrounding code.

2005-10-30  Carlo Wood <run@alinoe.com>

	* ircd/channel.c (sub1_from_channel): Delay destruction for -A
	channels.  They become zombie channels (zannels).
	(mode_parse_upass): Add duration to ERR_NOMANAGER message.
	(mode_parse_apass): Likewise.  Unconditionally set the member who
	sets Apass as oplevel 0.  Clear Upass when clearing Apass.
	(joinbuf_join): Remove code to pass oplevel in JOIN.

	* ircd/m_burst.c (ms_burst): Handle zannels.

	* ircd/m_join.c (m_join): Handle a join to a zannel.  If the user
	is joining with ops and/or an oplevel, send those.
	(ms_join): Stop trying to parse oplevels in JOIN.  Copy join
	timestamp when a user joins a zannel.

	* ircd/m_mode.c (ms_mode): Never generate HACK3.  Silently allow a
	user to op himself if he is the only one in a channel.

	* ircd/s_err.c (ERR_UPASSSET): Remove extra space.
	(ERR_UPASSNOTSET): Likewise.
	(ERR_NOMANAGER): Add field for channel lifetime.

2005-10-30  Michael Poole <mdpoole@troilus.org>

	* ircd/m_join.c (m_join): Reorganize to reduce edit distance from
	previous version and match code on u2_10_12_branch.

2005-10-30  Michael Poole <mdpoole@troilus.org>

	* .cvsignore: Add autom4te.cache.

	* ircd/.cvsignore: Add convert-conf.

	* ircd/test/.cvsignore: Add ircd_match_t.

	* patches/.cvsignore: Add marks.

2005-10-30  Andrew Miller  <a1kmm@amxl.com>

	* ircd/m_join.c (m_join): Fix check for OVERRIDE when the real channel
	key is override.

2005-10-28  Alex Badea  <vamposdecampos@gmail.com>

	* ircd/m_kick.c (ms_kick): Fix format string typo (bug #1339538)

2005-10-17  Michael Poole <mdpoole@troilus.org>
	This code inspired by ircd-hybrid's implementation of the same
	idea.  Thanks, Dianora!

	* include/s_user.h: Declare isupport manipulation functions.

	* include/supported.h: Delete.

	* ircd/ircd.c (main): Call init_isupport().

	* ircd/ircd_features.c (set_isupport_*): New functions to set
	feature-based isupport settings.

	* ircd/m_defaults.c: Remove unused #include "supported.h".

	* ircd/m_proto.c: Likewise.

	* ircd/m_version.c: Likewise.

	* ircd/s_user.c: Remove #include "supported.h".  Declare new
	struct ISupport.
	(isupport): New file-scope variable.
	(isupport_lines): Likewise.
	(touch_isupport): New function.
	(get_clean_isupport): New function.
	(add_isupport*): New functions.
	(del_isupport): New function.
	(build_isupport_lines): New function.
	(init_isupport): New function.
	(send_supported): Rewrite to use the above.

	* ircd/Makefile.in: Update dependencies.

2005-10-17  Diane Bruce  <db@db.net>

	* ircd/ircd_res.c: Don't send retries if the client did
	not resolve (SERVFAIL); this fixes a bug causing a flurry
	of retries in this case

2005-10-12  Michael Poole <mdpoole@troilus.org>

	* doc/example.conf: Update documentation to match this change.

	* ircd/client.c (client_set_privs): Make default global oper
	privileges match what was in 2.10.11.

2005-10-12  Perry Lorier <isomer@undernet.org>

	* include/s_stats.h: Add new "Local" only flag to /stats.

	* ircd/m_stats.c: Consult it.

	* ircd/s_stats.c: Use the flag.

2004-01-04  Kevin L Mitchell  <klmitch@mit.edu>

	* ircd/s_numeric.c (do_numeric): fix a crash when a numeric is
	sent to a channel...

2005-10-06  Michael Poole <mdpoole@troilus.org>

	* ircd/channel.c (clean_channelname): Delete unused function.

	* ircd/m_join.c (m_join): Report too-long channel names as
	non-existent.

2005-10-05  Michael Poole <mdpoole@troilus.org>

	* ircd/m_names.c (m_names): Fix format string when forwarding
	/names -D to other servers.
	(ms_names): Likewise.  Add support for remote /names -D.

2005-10-05  Michael Poole <mdpoole@troilus.org>

	* ircd/class.c (do_find_class): Fix bug from previous commit.

	* ircd/ircd_parser.y (clientblock): Allow setting Client port.

	* ircd/s_conf.c (check_limit_and_attach): Merge into attach_iline.
	(attach_iline): Only set FLAG_DOID when we are sure we will attach
	this Client block to the client. [Credit: Jukka Ollila and others]

2004-03-20  Fredrik Soderblom <froo@quakenet.org>

	* doc/readme.features: Document this new feature.

	* include/ircd_features.h (FEAT_USER_GLIST): New feature.

	* ircd/m_gline.c (m_gline): Consult it.

	* ircd/ircd_features.c (FEAT_USER_GLIST): Define it.

2005-10-04  Michael Poole <mdpoole@troilus.org>
	[Based on a patch by Jukka Ollila]

	* include/class.h (find_class): Rename to do_find_class().

	* ircd/class.c (class_delete_marked): Keep invalid classes in list
	until next rehash.
	(add_class): Use new parameter to do_find_class() to allow a class
	to be "resurrected".
	(find_class): Rename.
	(report_classes): Use 'y' instead of 'Y' when reporting invalid
	classes.

2005-10-01  Michael Poole <mdpoole@troilus.org>

	* ircd/m_kick.c (m_kick): Remove gratuitous CheckDelayedJoins().
	(ms_kick): If the kick target is join-delayed, only send the KICK
	to the kicker.  Spotted by Cesar_.

2005-10-01  Michael Poole <mdpoole@troilus.org>

	* ircd/class.c (init_class): Only set default class's ->next
	pointer when first allocating it.

2005-09-30  Michael Poole <mdpoole@troilus.org>

	* ircd/m_who.c (m_who): Handle matchsel & WHO_FIELD_ACC when
	matching users.

2005-09-30  Michael Poole <mdpoole@troilus.org>

	* include/whocmds.h: File becomes unused and almost empty; remove.

	* ircd/whocmds.c: Likewise.

	* ircd/gline.c (count_users): Move from whocmds.c and make static.

	* ircd/m_who.c: Doxygenate comments about command handlers.  Do
	not #include "whocmds.h", but instead #include "ircd_snprintf.h".
	(WHOSELECT_*): Moved from whocmds.h.
	(WHO_FIELD_*): Likewise.
	(IS_VISIBLE_USER): Likewise.
	(SEE_LUSER): Likewise.
	(SEE_USER): Likewise.
	(SHOW_MORE): Likewise.
	(SEE_CHANNEL): Likewise.
	(do_who): Move from whocmds.c and make static.

	* ircd/m_whois.c: Do not #include "whocmds.h".
	(MAX_WHOIS_USERS): Moved from whocmds.h.

	* ircd/parse.c: Do not #include "whocmds.h".

	* ircd/Makefile.in: Remove mention of whocmds.  Update depends.

2005-09-30  Michael Poole <mdpoole@troilus.org>

	* ircd/test/Makefile.in: Add missing path component in warning
	message about Makefile.in.bak.

2005-09-30  Michael Poole <mdpoole@troilus.org>

	* ChangeLog: Move old contents to ChangeLog.12 and create anew.

	* include/patchlevel.h: Bump to 2.10.13.alpha.0.
